{% extends "base.html" %}
{% load static store_extras %}

{% block title %}{{ product.name }} | Artist Portfolio{% endblock %}

{% block meta_description %}
{{ product.description|default:product.name|truncatechars:155 }}
{% endblock %}

{% block og_title %}
{{ product.name }} | Artist Portfolio
{% endblock %}

{% block og_description %}
{{ product.description|default:product.name|truncatechars:200 }}
{% endblock %}

{% block og_type %}product{% endblock %}

{% block canonical_url %}
{{ request.build_absolute_uri }}
{% endblock %}

{% block og_image %}
{% static 'images/placeholder.png' as fallback %}
{% with image_url=product.image|image_url_or:fallback %}
{{ request.scheme }}://{{ request.get_host }}{{ image_url }}
{% endwith %}
{% endblock %}

{% block extra_styles %}
<link rel="stylesheet" href="{% static 'css/store.css' %}">
{% endblock %}

{% block content %}
<div class="container product-detail-page">
    {% static 'images/placeholder.png' as fallback %}
    {% with image_url=product.image|image_url_or:fallback %}
    <div class="product-detail-layout">
        <div class="product-detail-image-wrap">
            <img src="{{ image_url }}" alt="{{ product.name }}" class="product-detail-image">
        </div>

        <div class="product-detail-content">
            <h1>{{ product.name }}</h1>
            <p class="product-detail-price">${{ product.price }}</p>

            <p class="availability">
                {% if product.is_available %}
                    <span class="in-stock">In stock</span>
                {% else %}
                    <span class="out-of-stock">Made only to order</span>
                {% endif %}
            </p>

            {% if product.description %}
                <p>{{ product.description }}</p>
            {% endif %}

            <ul class="product-detail-specs">
                {% if product.size %}<li><strong>Size:</strong> {{ product.size }}</li>{% endif %}
                {% if product.technique %}<li><strong>Technique:</strong> {{ product.technique }}</li>{% endif %}
                {% if product.paints %}<li><strong>Paints:</strong> {{ product.paints }}</li>{% endif %}
                {% if product.plot %}<li><strong>Plot:</strong> {{ product.plot }}</li>{% endif %}
            </ul>

            <div class="product-detail-actions">
                <button onclick="addToCart({{ product.id }})">Add to Cart</button>
                <a href="https://artist-portfolio-3d-gallery.onrender.com/?image={{ image_url|urlencode }}" target="_blank" class="sort-button">View in 3D</a>
                <a href="{% url 'store:product-list' %}" class="sort-button">‚Üê Back to store</a>
            </div>
        </div>
    </div>
    {% endwith %}
</div>

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Product",
  "name": "{{ product.name|escapejs }}",
  "description": "{{ product.description|default:''|striptags|escapejs }}",
  "offers": {
    "@type": "Offer",
    "priceCurrency": "USD",
    "price": "{{ product.price }}",
    "availability": "{% if product.is_available %}https://schema.org/InStock{% else %}https://schema.org/PreOrder{% endif %}"
  }
}
</script>
{% endblock %}

{% block extra_scripts %}
<script src="{% static 'js/store.js' %}"></script>
{% endblock %}